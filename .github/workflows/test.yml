name: Merge to Staging

on:
  workflow_run:
    workflows: ["CI - API"]
    types: [completed]
  workflow_dispatch:

permissions:
  contents: write
  actions: read

jobs:
  merge-to-staging:
    # Only proceed if workflow_run was successful (not for workflow_dispatch)
    if: ${{ github.event_name == 'workflow_dispatch' || github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest
    environment: staging
    steps:
      - name: Get workflow information
        run: |
          echo "üîç Workflow Information:"
          echo "  Event: ${{ github.event_name }}"
          echo "  Repository: ${{ github.repository }}"
          echo "  Actor: ${{ github.actor }}"
          echo ""

          if [ "${{ github.event_name }}" = "workflow_run" ]; then
            echo "üìã Triggered by workflow:"
            echo "  Workflow: ${{ github.event.workflow_run.name }}"
            echo "  Conclusion: ${{ github.event.workflow_run.conclusion }}"
            echo "  Branch: ${{ github.event.workflow_run.head_branch }}"
            echo "  SHA: ${{ github.event.workflow_run.head_sha }}"
            echo "  URL: ${{ github.event.workflow_run.html_url }}"
          else
            echo "üìã Manually triggered"
            echo "  Branch: ${{ github.ref_name }}"
            echo "  SHA: ${{ github.sha }}"
          fi

      - name: Simulate merge to staging
        run: |
          echo ""
          echo "üöÄ This is where we would merge to staging!"
          echo ""
          echo "‚úÖ Merge simulation completed successfully"
